---
title: "Biological Expressions of Early Life Trauma"
author: "GAN"
date of creation: "6/23/2021"
date of last update: "7/5/22" 
output: html_document
---

```{r}
knitr::opts_chunk$set(echo = TRUE)

```

```{r}
library (tidyverse)
library (haven)
library (tidymodels)
library (parsnip)
library (boot)
library (Hmisc)
library (dplyr)
library (table1)
library (naniar)
library (visdat)
```


## Location of the data files 



```{r}


lh <- read_sas("DATASET LOCATION")
.name_repair = "universal"%>%

    
  
zap_label()

head (lh)

col(lh)


```


## Exposure Variable Coding 

Creating the code for parental death and parental separation 

```{r}
lh <- lh %>% mutate(p_death = (sumrow=orphanage16+foster16+parentdeath16))%>%
  mutate(p_sep = (sumrow=mother_sep16+father_sep16 ))



table (lh$p_death)
table (lh$p_sep)

p_death.freq <- xtabs(~p_death, data=lh)
p_death.freq

p_sep.freq <- xtabs (~p_sep, data=lh)
p_sep.freq

p_death.prop <- prop.table(p_death.freq)
p_death.prop

p_sep.prop<- prop.table(p_sep.freq)
p_sep.prop

parent_ed.freq <- xtabs (~parent_ed, data=lh)
parent_ed.prop<- prop.table(parent_ed.freq)
parent_ed.prop

edu.freq <- xtabs (~edu, data=lh)
edu.prop<- prop.table(edu.freq)
edu.prop


#adding code for parental death and parental separation as a binary variable 

lh <- lh%>% 
  mutate(pdeath_bin = case_when( p_death >= 1  ~1,
                                 p_death < 1 ~0 
  ))

lh <- lh%>% 
  mutate(psep_bin = case_when( p_sep >= 1  ~1,
                                 p_sep < 1 ~0 ))



pdeath_bin.freq <- xtabs (~pdeath_bin, data=lh)
pdeath_bin.prop<- prop.table(pdeath_bin.freq)


psep_bin.freq <- xtabs (~psep_bin, data=lh)
psep_bin.prop<- prop.table(psep_bin.freq)


psep_bin.prop
pdeath_bin.prop

psep_bin.freq
pdeath_bin.freq




```

## Data Cleaning 

Subsetting to only variables used in the analysis 


```{r}
head(lh)

myvars <- c('p_death', 'p_sep', 'Il6_binary', 'crp_binary', 'tnf_Binary', 
'RAGENDER' , 'R13AGEY_B' , 'parent_ed' , 'edu' ,'smoke' , 'R13SHLTC' , 'R13HLTC' , 'R13CONDE' , 'R13ADLC', 'eligiblev2', 'hhidpn', 'PVBSWGTR' , 'race_eth', 'psep_bin' , 'pdeath_bin' , 'ln_il6' , 'cmv_cont'  , 'ln_tnf' , 'ln_crp' , 'ln_cmv' , 'cmv_contv2' , 'R13BMI' )

lh2 <- lh[myvars] 

summary(lh)

#Hardcode the categorical variables into factors 

lh2$p_ed <- factor(lh2$parent_ed, 
                     levels=c(0,1,2,3), ordered=TRUE,
                     labels= c("8 years or less", "9-11 years", "HS graduate", "Greater than HS"))
lh2$ed <- factor(lh2$edu, 
                     levels=c(0,1,2,3), ordered=TRUE, 
                     labels= c("8 years or less", "9-11 years", "HS graduate", "Greater than HS"))
lh2$race <- factor(lh2$race_eth, 
                     levels=c(0,1,2,3), 
                     labels= c("Non-Hispanic White", "Non-Hispanic Black", "Hispanic", "Other"))
lh2$gender <- factor(lh2$RAGENDER, 
                     levels=c(1,2), 
                     labels= c("Male", "Female"))
lh2$smokev2 <- factor(lh2$smoke, 
                     levels=c(0,1,2), ordered=TRUE,
                     labels= c("Never Smoker", "Former Smoker", "Current Smoker"))
lh2$pdeath_b <- factor(lh2$pdeath_bin, 
                     levels=c(0,1), ordered=TRUE,
                     labels= c("0","1"))
lh2$psep_b <- factor(lh2$psep_bin, 
                     levels=c(0,1), ordered=TRUE,
                     labels= c("0","1"))



table(lh2$p_ed, useNA = "always" )
table(lh2$ed, useNA = "always" )
table(lh2$race, useNA = "always" )
table(lh2$smokev2, useNA = "always" )
table(lh2$psep_b, useNA = "always" )
table(lh2$pdeath_b, useNA = "always" )


colnames(lh2)


```

```{r}
library(mice) 
library(naniar)
library (tidyverse)
 
#imputing on parental education, participant education, body mass index, smoking status, parental separation, and parental death  

#extracting names of variables that have missingness

df_before <- lh2
allvars <-names(df_before)
allvars
missvars <-names(df_before)[colSums (is.na(df_before)) >0 ]
missvars
colnames(lh2)

predictormatrix <-matrix(0, ncol=length(allvars), nrow=length(allvars))
predictormatrix <- matrix(0, ncol = length(allvars), nrow = length(allvars))
predictormatrix
rownames (predictormatrix) <-allvars
colnames (predictormatrix) <-allvars
predictormatrix

# specifying variables informing the imputation
imputervars <- c("p_ed" , "ed", "race", "RAGENDER" , "R13AGEY_B" , "smokev2")
head(lh2)
summary(lh2)
imputervars <-intersect(unique(imputervars), allvars)
imputervars

imputermatrix <-predictormatrix
imputermatrix[, imputervars] <- 1 
imputermatrix

#specifying variables to be imputed 

imputedonlyvars <-c("p_ed", "ed" , "smokeV2" , "R13BMI" , "race",  "psep_b" , "pdeath_b")
imputedvars <- intersect(unique(c(imputedonlyvars, imputervars)), missvars)
imputedvars
imputedmatrix <-predictormatrix 
imputedmatrix[imputedvars,  ] <-1 
imputedmatrix 

predictormatrix <-imputermatrix*imputedmatrix 
diag(predictormatrix) <- 0
predictormatrix

#dry run for the imputation


#specifying the method 

dryMice <- mice(data=lh2, m=1, predictorMatrix = predictormatrix)

# Ordered categorical variables 
poly <- c("p_ed",  "psep_b", "pdeath_b" , "ed" , "smokev2")

# Dichotomous variable
log <- c()

# Unordered categorical variable 
poly2 <- c()

poly2 <-c("race")

#Continuous Variables
norm <- c("R13BMI")


# Turn their methods matrix into the specified imputation models
meth=dryMice$method 
meth[allvars]=""
meth

#create a vector for each group of variables for the different methods 

meth[poly] <- "polr"
length(meth)
meth

meth[poly2] <- "polyreg"
length(meth)
meth

meth [norm] <- "norm"
length(meth)
meth


table(lh2$smoke)
table(lh2$race_eth)
table(lh2$parent_ed)
table(lh2$edu)
table(lh2$p_ed)
mean(lh2$edu, na.rm=TRUE)
mean(lh2$p_ed, na.rm=TRUE)

#declare the variables as ordered factors 

dryMice <- mice(data=lh2, m=1, predictorMatrix = predictormatrix)
complete(dryMice)
dryMice
predictormatrix

imp <- mice(data=lh2, m=100, predictorMatrix = predictormatrix, method=meth)
meth=dryMice$method
meth

#inspecting the imputation 
complete(imp)
imp

attributes
imp$data
imp$imp

c.long <-complete(imp, "long")
c.long


table(lh2$p_ed, useNA = "always")
table(lh2$ed, useNA = "always")
table(lh2$race, useNA = "always")
table(lh2$smokev2, useNA = "always")
table(lh2$psep_b,useNA = "always")
table(lh2$pdeath_b, useNA = "always")
table(lh2$R13BMI, useNA="always")

#Checking Parent Ed
table(lh2$p_ed, useNA = "always")
table(c.long$p_ed, useNA="always")

p_edprop <-prop.table(table(lh2$p_ed, useNA = "always"))
p_edprop
p_ed_imp_prop <-prop.table(table(c.long$p_ed, useNA="always"))
p_ed_imp_prop

#Checking Education 

table(lh2$ed, useNA = "always")
table(c.long$ed, useNA="always")

edprop <-prop.table(table(lh2$ed, useNA = "always"))
edprop
ed_imp_prop <-prop.table(table(c.long$ed, useNA="always"))
ed_imp_prop

#Checking Race 

table(lh2$race, useNA = "always")
table(c.long$race, useNA="always")

raceprop <-prop.table(table(lh2$race, useNA = "always"))
raceprop
race_imp_prop <-prop.table(table(c.long$race, useNA="always"))
race_imp_prop

#Checking SmokeV2

table(lh2$smokev2, useNA = "always")
table(c.long$smokev2, useNA="always")

smokeprop <-prop.table(table(lh2$smokev2, useNA = "always"))
smokeprop
smoke_imp_prop <-prop.table(table(c.long$smokev2, useNA="always"))
smoke_imp_prop

#Checking Parental Separation 

table(lh2$psep_b, useNA = "always")
table(c.long$psep_b, useNA="always")

psepprop <-prop.table(table(lh2$psep_b, useNA = "always"))
psepprop
psep_imp_prop <-prop.table(table(c.long$psep_b, useNA="always"))
psep_imp_prop

#Checking Parental Death 

table(lh2$pdeath_b, useNA = "always")
table(c.long$pdeath_b, useNA="always")


pdeathprop <-prop.table(table(lh2$pdeath_b, useNA = "always"))
pdeathprop
pdeath_imp_prop <-prop.table(table(c.long$pdeath_b, useNA="always"))
pdeath_imp_prop

```

```{r}
library(MASS)
library(survey)
library(mice)
library(stargazer)
library(texreg)
library(svyVGAM)
library(broom.mixed)
library(mitools)
library(survey)
library(Amelia)
library(ggplot2)
library(aod)
library(texreg)
library(miceadds)
library(mitools)
library(survey)
library(Amelia)
library(ggplot2)
library(aod)
library(texreg)
library(svyVGAM)

#load ("C:LOCATION OF IMPUTATION DATA\\RCode\\Rdata\\imputation.Rdata")

head(imp)

#save(imp,   file="C:LOCATION TO SAVE IMPUTATION DATA\\RCode\\Rdata\\imputation.Rdata")





imp_list <- imputationList(lapply(1:imp$m, function(n) mice::complete(imp, action = n)))
des <- svydesign(ids=~hhidpn, weights=~PVBSWGTR,data=imp_list)

dsub_bl<-subset(des, race=="Non-Hispanic Black")
dsub_wh<-subset(des, race=="Non-Hispanic White")
dsub_his<-subset(des, race=="Hispanic")
dsub_other<-subset(des, race=="Other")




#colnames(lh2)

##CMV Models
#First set of models; CMV and Parental Death



cmv_model1 <- with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model2 <- with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
cmv_model3 <- with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
cmv_model4 <- with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI , family=stats::gaussian()))



## Model 1
model1_list <- list()
for(i in 1:length(cmv_model1)){
  tmp_obj <- cmv_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))
pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t
pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t
pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t
pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

model1_pooled <- pooled_est1 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2


model2_list <- list()
for(i in 1:length(cmv_model2)){
  tmp_obj <- cmv_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

#first is row, second is column

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))
pooled_est2[1,2]=dpooled21$qbar
pooled_est2[1,3]=dpooled21$t
pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t
pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t
pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t
pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

pooled_est2

model2_pooled <- pooled_est2 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)




## Model 3




model3_list <- list()
for(i in 1:length(cmv_model3)){
  tmp_obj <- cmv_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}

mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)


death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

#first is row, second is column

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t

pooled_est3

model3_pooled <- pooled_est3 %>% 
    add_column(Model = "CMV, Model 3")%>%
    add_column(Outcome = "CMV")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)


#
# ## Model 4

model4_list <- list()
for(i in 1:length(cmv_model4)){
   tmp_obj <- cmv_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp

 }


 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 mod4_reslong$var <- rep(varnames,100)



 death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

  dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
  dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
  dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
  dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
  dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
  dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
  dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
  dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
  dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
  dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
  dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
  dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
  dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
  dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
  dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)
  
  
  

 pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
  pooled_est4[1,2]=dpooled41$qbar
  pooled_est4[1,3]=dpooled41$t
  pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t
 
 

 model4_pooled <- pooled_est4 %>%
     add_column(Model = "CMV, Model 4")%>%
     add_column(Outcome = "CMV")


 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se)
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)

##Figure



model1_tot <- filter(model1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Death")


model_cmv_regress <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)
  
model_cmv_full <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_cmv_full





plot1_cmv<-
  
  ggplot(data=model_cmv_full, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_cmv_full), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.75, 1.5))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_cmv_full$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and gender.\n Model 2 includes age, gender, and parental education.\n Model 3 includes age, gender, parental education, and race/ethnicity. \n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot1_cmv




#Exporting as a table 
write.csv(model_cmv_regress,"LOCATION OF FOLDER\\Tables\\Tables from R\\CMVModel_full_death.csv", row.names = FALSE)
```



```{r}
##Parental Separation 


##CMV Models
#First set of models; CMV and Parental Separation



cmv_model1 <- with(des, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model2 <- with(des, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
cmv_model3 <- with(des, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
cmv_model4 <- with(des, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI  , family=stats::gaussian()))


## Model 1
model1_list <- list()
for(i in 1:length(cmv_model1)){
  tmp_obj <- cmv_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")

dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t
pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t
pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t
pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

model1_pooled <- pooled_est1 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(cmv_model2)){
  tmp_obj <- cmv_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")

dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))
pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t
pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t
pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t
pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t
pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t


model2_pooled <- pooled_est2 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(cmv_model3)){
  tmp_obj <- cmv_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)

death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))
pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t

model3_pooled <- pooled_est3 %>% 
    add_column(Model = "CMV, Model 3")%>%
    add_column(Outcome = "CMV")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)




## Model 4
model4_list <- list()
 for(i in 1:length(cmv_model4)){
   tmp_obj <- cmv_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp
   
 }

 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 mod4_reslong$var <- rep(varnames,100)
 

 death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

  dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
  dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
  dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
  dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
  dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
  dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
  dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
  dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
  dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
  dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
  dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
  dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
  dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
  dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
  dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)
  
  
  

 pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
  pooled_est4[1,2]=dpooled41$qbar
  pooled_est4[1,3]=dpooled41$t
  pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t

 
 model4_pooled <- pooled_est4 %>% 
     add_column(Model = "CMV, Model 4")%>%
     add_column(Outcome = "CMV")
 
 
 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)




##Figure 

model_cmv_regress_sep <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

model1_tot <- filter(model1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Separation")



  
model_cmv_full_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_cmv_full_sep

write.csv(model_cmv_regress_sep,"C:\\LOCATION OF FOLDER\\Tables\\Tables from R\\CMVModel_full_sep.csv", row.names = FALSE)





plot2_cmv<-
  
  ggplot(data=model_cmv_full_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_cmv_full_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.75, 1.75))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_cmv_full_sep$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and gender.\n Model 2 includes age, gender, and parental education.\n Model 3 includes age, gender, parental education, and race/ethnicity. \n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot2_cmv






```


```{r}
##sTNFR-1

##TNF Models
#First set of models; TNF and Parental Death

tnf_model1 <- with(des, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model2 <- with(des, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model3 <- with(des, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
tnf_model4 <- with(des, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI , family=stats::gaussian()))


## Model 1
model1_list <- list()
for(i in 1:length(tnf_model1)){
  tmp_obj <- tnf_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t
pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t
pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t
pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

model1_pooled <- pooled_est1 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(tnf_model2)){
  tmp_obj <- tnf_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)

death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t
pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t
pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t
pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t
pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

model2_pooled <- pooled_est2 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(tnf_model3)){
  tmp_obj <- tnf_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)

death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")



dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)


pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))

pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t





model3_pooled <- pooled_est3 %>% 
    add_column(Model = "sTNF, Model 3")%>%
    add_column(Outcome = "sTNF")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)




# ## Model 4
model4_list <- list()
 for(i in 1:length(tnf_model4)){
   tmp_obj <- tnf_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp
   
 }
# 
# 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")

 mod4_reslong$var <- rep(varnames,100)
 
 


death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)




pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
pooled_est4[1,2]=dpooled41$qbar
pooled_est4[1,3]=dpooled41$t
pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t
 
 model4_pooled <- pooled_est4 %>% 
     add_column(Model = "sTNF, Model 4")%>%
     add_column(Outcome = "sTNF")

 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)

##Figure 



model1_tot <- filter(model1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Death")



model_tnf_full_regress <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

write.csv(model_tnf_full_regress,"C:LOCATION OF FOLDER\\Tables\\Tables from R\\TNFModel_full_death.csv", row.names = FALSE)
  
model_tnf_full <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_tnf_full


library(forestplot)


plot1_tnf<-
  
  ggplot(data=model_tnf_full, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_tnf_full), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.1))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_tnf_full$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and sex/gender.\n Model 2 includes age, sex/gender, and parental education.\n Model 3 includes age, sex/gender, parental education, and race/ethnicity.\n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot1_tnf
```



```{r}

#TNF Models
#First set of models; TNF and Parental Separation 

tnf_model1 <- with(des, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model2 <- with(des, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model3 <- with(des, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
 tnf_model4 <- with(des, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC +R13BMI , family=stats::gaussian()))


## Model 1
model1_list <- list()
for(i in 1:length(tnf_model1)){
  tmp_obj <- tnf_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")



dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

model1_pooled <- pooled_est1 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(tnf_model2)){
  tmp_obj <- tnf_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")

dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t
pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t
pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t
pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t
pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

model2_pooled <- pooled_est2 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(tnf_model3)){
  tmp_obj <- tnf_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)


death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")



dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))

pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t

model3_pooled <- pooled_est3 %>% 
    add_column(Model = "sTNF, Model 3")%>%
    add_column(Outcome = "sTNF")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)



 
# ## Model 4
 model4_list <- list()
 for(i in 1:length(tnf_model4)){
   tmp_obj <- tnf_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp
   
 }
 
 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 
 mod4_reslong$var <- rep(varnames,100)
 
 death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
pooled_est4[1,2]=dpooled41$qbar
pooled_est4[1,3]=dpooled41$t
pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t

 
 model4_pooled <- pooled_est4 %>% 
     add_column(Model = "sTNF, Model 4")%>%
     add_column(Outcome = "sTNF")
 
 
 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)

 
##Figure 



model1_tot <- filter(model1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Separation")



  
model_tnf_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_tnf_regress_sep <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

write.csv(model_tnf_regress_sep,"C:LOCATION OF FOLDERS\\Tables\\Tables from R\\TNFModel_full_sep.csv", row.names = FALSE)





plot2_tnf<-
  
  ggplot(data=model_tnf_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_tnf_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.1))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_tnf_sep$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and sex/gender.\n Model 2 includes age, sex/gender, and parental education.\n Model 3 includes age, sex/gender, parental education, and race/ethnicity.\n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index,  change in functional limitations, and BMI.") 


plot2_tnf
```


```{r}
##IL-6

#IL-6 Models
#First set of models; IL-6 and Parental Death

il6_model1 <- with(des, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model2 <- with(des, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model3 <- with(des, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
il6_model4 <- with(des, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI , family=stats::gaussian()))


## Model 1
model1_list <- list()
for(i in 1:length(il6_model1)){
  tmp_obj <- il6_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t


model1_pooled <- pooled_est1 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(il6_model2)){
  tmp_obj <- il6_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Death")
death_pool22 <- filter(mod2_reslong, var=="Age")
death_pool23 <- filter(mod2_reslong, var=="Gender")
death_pool24 <- filter(mod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

model2_pooled <- pooled_est2 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(il6_model3)){
  tmp_obj <- il6_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)


death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))

pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t

model3_pooled <- pooled_est3 %>% 
    add_column(Model = "IL-6, Model 3")%>%
    add_column(Outcome = "IL-6")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)



# ## Model 4
# model4_list <- list()
# for(i in 1:length(il6_model4)){
#   tmp_obj <- il6_model4[[i]]
#   coeff <- data.frame("coef"=tmp_obj$coefficients)
#   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
#   tmp <-data.frame(bind_cols(coeff, vari))
#   tmp$setno <- i
#   model4_list[[i]] <- tmp
#   
# }

 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 mod4_reslong$var <- rep(varnames,100)

death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
pooled_est4[1,2]=dpooled41$qbar
pooled_est4[1,3]=dpooled41$t
pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t 
 
 model4_pooled <- pooled_est4 %>% 
     add_column(Model = "IL-6, Model 4")%>%
     add_column(Outcome = "IL-6")
 
 
 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)


##Figure 



model1_tot <- filter(model1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Death")



  
model_il6_full <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_il6_full

model_il6_regress_death <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

write.csv(model_il6_regress_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\IL6Model_full_death.csv", row.names = FALSE)




plot1_il6<-
  
  ggplot(data=model_il6_full, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_il6_full), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.2))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_il6_full$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and sex/gender.\n Model 2 includes age, sex/gender, and parental education.\n Model 3 includes age, sex/gender, parental education, and race/ethnicity.\n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot1_il6
```


```{r}
#IL-6 Models
#First set of models; IL-6 and Parental Separation

il6_model1 <- with(des, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model2 <- with(des, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model3 <- with(des, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
il6_model4 <- with(des, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI , family=stats::gaussian()))


## Model 1
model1_list <- list()
for(i in 1:length(il6_model1)){
  tmp_obj <- il6_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t
pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t
pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t
pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

model1_pooled <- pooled_est1 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(il6_model2)){
  tmp_obj <- il6_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t
pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t
pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t
pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t
pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

model2_pooled <- pooled_est2 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(il6_model3)){
  tmp_obj <- il6_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)


death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))

pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t

pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t

pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t

pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t

pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t

pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t

pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t

pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t


model3_pooled <- pooled_est3 %>% 
    add_column(Model = "IL-6, Model 3")%>%
    add_column(Outcome = "IL-6")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)


# ## Model 4
 model4_list <- list()
 for(i in 1:length(il6_model4)){
   tmp_obj <- il6_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp
   
 }
 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 mod4_reslong$var <- rep(varnames,100)
 
death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)




pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
pooled_est4[1,2]=dpooled41$qbar
pooled_est4[1,3]=dpooled41$t
pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t

 
 model4_pooled <- pooled_est4 %>% 
     add_column(Model = "IL-6, Model 4")%>%
     add_column(Outcome = "IL-6")
 
 
 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)

 
 
##Figure 



model1_tot <- filter(model1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Separation")




  
model_il6_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_il6_sep

model_il6_regress_sep <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

write.csv(model_il6_regress_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\IL6Model_full_sep.csv", row.names = FALSE)


plot2_il6<-
  
  ggplot(data=model_il6_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_il6_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.1))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_il6_sep$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and sex/gender.\n Model 2 includes age, sex/gender, and parental education.\n Model 3 includes age, sex/gender, parental education, and race/ethnicity.\n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot2_il6
```


```{r}
##CRP 


##CRP Models
#First set of models; CRP and Parental Death

crp_model1 <- with(des, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model2 <- with(des, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model3 <- with(des, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
crp_model4 <- with(des, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI , family=stats::gaussian()))




## Model 1
model1_list <- list()
for(i in 1:length(crp_model1)){
  tmp_obj <- crp_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")

dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

model1_pooled <- pooled_est1 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(crp_model2)){
  tmp_obj <- crp_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t
pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t
pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t
pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t
pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t


model2_pooled <- pooled_est2 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(crp_model3)){
  tmp_obj <- crp_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)


death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))

pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t

pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t

pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t

pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t

pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t

pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t

pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t

pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t



model3_pooled <- pooled_est3 %>% 
    add_column(Model = "CRP, Model 3")%>%
    add_column(Outcome = "CRP")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)


 

# ## Model 4
 model4_list <- list()
 for(i in 1:length(crp_model4)){
   tmp_obj <- crp_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp
   
 }
 
 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 
 mod4_reslong$var <- rep(varnames,100)
 

 death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
pooled_est4[1,2]=dpooled41$qbar
pooled_est4[1,3]=dpooled41$t
pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t
 
  model4_pooled <- pooled_est4 %>% 
     add_column(Model = "CRP, Model 4")%>%
     add_column(Outcome = "CRP")
 
 
 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)

 
 
##Figure 



model1_tot <- filter(model1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Death")


model_crp_regress_death <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

write.csv(model_crp_regress_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CRPModel_full_death.csv", row.names = FALSE)

  
model_crp_full <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_crp_full



plot1_crp<-
  
  ggplot(data=model_crp_full, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_crp_full), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.2))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_crp_full$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and sex/gender.\n Model 2 includes age, sex/gender, and parental education.\n Model 3 includes age, sex/gender, parental education, and race/ethnicity.\n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot1_crp




```

```{r}
##CRP Models
#First set of models; CRP and Parental Separation

crp_model1 <- with(des, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model2 <- with(des, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model3 <- with(des, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race, family=stats::gaussian()))
crp_model4 <- with(des, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI  , family=stats::gaussian()))


## Model 1
model1_list <- list()
for(i in 1:length(crp_model1)){
  tmp_obj <- crp_model1[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model1_list[[i]] <- tmp
  
}


mod1_reslong <- bind_rows(model1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
mod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(mod1_reslong, var=="Intercept")
death_pool12 <- filter(mod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(mod1_reslong, var=="Age")
death_pool14 <- filter(mod1_reslong, var=="Gender")



dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t


model1_pooled <- pooled_est1 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")
  

model1_pooled$se <- sqrt(model1_pooled$vari)
model1_pooled$ll <- model1_pooled$coef - (1.96*model1_pooled$se) 
model1_pooled$ul <- (1.96*model1_pooled$se) + model1_pooled$coef 
model1_pooled$exp_est <- exp(model1_pooled$coef)
model1_pooled$exp_ll <-  exp(model1_pooled$ll)
model1_pooled$exp_ul <-  exp(model1_pooled$ul)

model1_pooled


## Model 2
model2_list <- list()
for(i in 1:length(crp_model2)){
  tmp_obj <- crp_model2[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model2_list[[i]] <- tmp
  
}


mod2_reslong <- bind_rows(model2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
mod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(mod2_reslong, var=="Intercept")
death_pool22 <- filter(mod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(mod2_reslong, var=="Age")
death_pool24 <- filter(mod2_reslong, var=="Gender")
death_pool25 <- filter(mod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)

pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

model2_pooled <- pooled_est2 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")


model2_pooled$se <- sqrt(model2_pooled$vari)
model2_pooled$ll <- model2_pooled$coef - (1.96*model2_pooled$se) 
model2_pooled$ul <- (1.96*model2_pooled$se) + model2_pooled$coef 
model2_pooled$exp_est <- exp(model2_pooled$coef)
model2_pooled$exp_ll <-  exp(model2_pooled$ll)
model2_pooled$exp_ul <-  exp(model2_pooled$ul)


## Model 3
model3_list <- list()
for(i in 1:length(crp_model3)){
  tmp_obj <- crp_model3[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  model3_list[[i]] <- tmp
  
}


mod3_reslong <- bind_rows(model3_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race")
mod3_reslong$var <- rep(varnames,100)


death_pool31 <- filter(mod3_reslong, var=="Intercept")
death_pool32 <- filter(mod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(mod3_reslong, var=="Age")
death_pool34 <- filter(mod3_reslong, var=="Gender")
death_pool35 <- filter(mod3_reslong, var=="Parental Education")
death_pool36 <- filter(mod3_reslong, var=="NH-Black")
death_pool37 <- filter(mod3_reslong, var=="Hispanic")
death_pool38 <- filter(mod3_reslong, var=="Other Race")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(8), vari=numeric(8))

pooled_est3[1,2] <- dpooled31$qbar
pooled_est3[1,3] <- dpooled31$t

pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t

pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t

pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t

pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t

pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t

pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t

pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t



model3_pooled <- pooled_est3 %>% 
    add_column(Model = "CRP, Model 3")%>%
    add_column(Outcome = "CRP")


model3_pooled$se <- sqrt(model3_pooled$vari)
model3_pooled$ll <- model3_pooled$coef - (1.96*model3_pooled$se) 
model3_pooled$ul <- (1.96*model3_pooled$se) + model3_pooled$coef 
model3_pooled$exp_est <- exp(model3_pooled$coef)
model3_pooled$exp_ll <-  exp(model3_pooled$ll)
model3_pooled$exp_ul <-  exp(model3_pooled$ul)



# ## Model 4
 model4_list <- list()
 for(i in 1:length(crp_model4)){
   tmp_obj <- crp_model4[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   model4_list[[i]] <- tmp
   
 }
 
 
 mod4_reslong <- bind_rows(model4_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "NH-Black", "Hispanic", "Other Race" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 mod4_reslong$var <- rep(varnames,100)

 death_pool41 <- filter(mod4_reslong, var=="Intercept")
death_pool42 <- filter(mod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(mod4_reslong, var=="Age")
death_pool44 <- filter(mod4_reslong, var=="Gender")
death_pool45 <- filter(mod4_reslong, var=="Parental Education")
death_pool46 <- filter(mod4_reslong, var=="NH-Black")
death_pool47 <- filter(mod4_reslong, var=="Hispanic")
death_pool48 <- filter(mod4_reslong, var=="Other Race")
death_pool49 <- filter(mod4_reslong, var=="Education")
death_pool50 <- filter(mod4_reslong, var=="Smoking Status")
death_pool51 <- filter(mod4_reslong, var=="Change in Self-Reported Health")
death_pool52 <- filter(mod4_reslong, var=="Self-Report of Health Change")
death_pool53 <- filter(mod4_reslong, var=="Chronic Condition Index")
death_pool54 <- filter(mod4_reslong, var=="Change in Functional Limitations")
death_pool55 <- filter(mod4_reslong, var=="BMI")

dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)
dpooled45 <- pool.scalar(death_pool45$coef, death_pool45$vari)
dpooled46 <- pool.scalar(death_pool46$coef, death_pool46$vari)
dpooled47 <- pool.scalar(death_pool47$coef, death_pool47$vari)
dpooled48 <- pool.scalar(death_pool48$coef, death_pool48$vari)
dpooled49 <- pool.scalar(death_pool49$coef, death_pool49$vari)
dpooled50 <- pool.scalar(death_pool50$coef, death_pool50$vari)
dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est4 <- data.frame(var = varnames, coef=numeric(15), vari=numeric(15))
pooled_est4[1,2]=dpooled41$qbar
pooled_est4[1,3]=dpooled41$t
pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t
pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t
pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t
pooled_est4[5,2] <- dpooled45$qbar
pooled_est4[5,3] <- dpooled45$t
pooled_est4[6,2] <- dpooled46$qbar
pooled_est4[6,3] <- dpooled46$t
pooled_est4[7,2] <- dpooled47$qbar
pooled_est4[7,3] <- dpooled47$t
pooled_est4[8,2] <- dpooled48$qbar
pooled_est4[8,3] <- dpooled48$t
pooled_est4[9,2] <- dpooled49$qbar
pooled_est4[9,3] <- dpooled49$t
pooled_est4[10,2] <- dpooled50$qbar
pooled_est4[10,3] <- dpooled50$t
pooled_est4[11,2] <- dpooled51$qbar
pooled_est4[11,3] <- dpooled51$t
pooled_est4[12,2] <- dpooled52$qbar
pooled_est4[12,3] <- dpooled52$t
pooled_est4[13,2] <- dpooled53$qbar
pooled_est4[13,3] <- dpooled53$t
pooled_est4[14,2] <- dpooled54$qbar
pooled_est4[14,3] <- dpooled54$t
pooled_est4[15,2] <- dpooled55$qbar
pooled_est4[15,3] <- dpooled55$t

 model4_pooled <- pooled_est4 %>% 
     add_column(Model = "CRP, Model 4")%>%
     add_column(Outcome = "CRP")
 
 
 model4_pooled$se <- sqrt(model4_pooled$vari)
 model4_pooled$ll <- model4_pooled$coef - (1.96*model4_pooled$se) 
 model4_pooled$ul <- (1.96*model4_pooled$se) + model4_pooled$coef 
 model4_pooled$exp_est <- exp(model4_pooled$coef)
 model4_pooled$exp_ll <-  exp(model4_pooled$ll)
 model4_pooled$exp_ul <-  exp(model4_pooled$ul)

 
##Figure 



model1_tot <- filter(model1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(model2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(model3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(model4_pooled, var=="Experienced Parental Separation")



model_crp_regress_sep <- rbind(model1_pooled, model2_pooled, model3_pooled, model4_pooled)

write.csv(model_crp_regress_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CRPModel_full_sep.csv", row.names = FALSE)
  
model_crp_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot)

model_crp_sep



plot2_crp<-
  
  ggplot(data=model_crp_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_crp_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.2))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_crp_sep$Model))))+
  theme(strip.text.y=element_text(angle=0))+ 
 labs( caption="Model 1 includes age and sex/gender.\n Model 2 includes age, sex/gender, and parental education.\n Model 3 includes age, sex/gender, parental education, and race/ethnicity.\n Model 4 includes age, gender, parental education, race/ethnicity, education, \n smoking status, change in self-reported health, self-report of health change,\n chronic condition index, change in functional limitations, and BMI.") 


plot2_crp


```


```{r}
##Checking Interaction Models 


#Checking the interaction with race 

library(mitools)
mitools.fit <- MIcombine(with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race, family=stats::gaussian())))

mitools.res<- summary(cmv_inter, conf.int=TRUE)
mitools.res<- cbind(mitools.res, df=mitools.fit$df)
mitools.res



##This code and function get p-values for the coefficients

MIcombineP <-function(MIcombineRes,digits=3) {
  tStat<-MIcombineRes$coefficients/sqrt(diag(MIcombineRes$variance))
  round(2*pt(-abs(tStat), df=MIcombineRes$df), digits)
}


model_cmv_death_inter <-(with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race, family=stats::gaussian())))
summary(MIcombine(model_cmv_death_inter))
MIcombineP(MIcombine(model_cmv_death_inter))

##Checking 3 way interaction 

#CMV Death 
model_cmv_death_inter <-(with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race + pdeath_b*parent_ed + parent_ed*race+ pdeath_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_cmv_death_inter))
MIcombineP(MIcombine(model_cmv_death_inter))

#CMV Separation 
model_cmv_sep_inter <-(with(des, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race + psep_b*parent_ed + parent_ed*race+ psep_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_cmv_sep_inter))
MIcombineP(MIcombine(model_cmv_sep_inter))

#TNF Death
model_tnf_death_inter <-(with(des, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race + pdeath_b*parent_ed + parent_ed*race+ pdeath_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_tnf_death_inter))
MIcombineP(MIcombine(model_tnf_death_inter))

#TNF Sep
model_tnf_sep_inter <-(with(des, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race + psep_b*parent_ed + parent_ed*race+ psep_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_tnf_sep_inter))
MIcombineP(MIcombine(model_tnf_sep_inter))

#IL6 Death
model_il6_death_inter <-(with(des, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race + pdeath_b*parent_ed + parent_ed*race+ pdeath_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_il6_death_inter))
MIcombineP(MIcombine(model_il6_death_inter))

#IL-6 Sep
model_il6_sep_inter <-(with(des, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race + psep_b*parent_ed + parent_ed*race+ psep_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_il6_sep_inter))
MIcombineP(MIcombine(model_il6_sep_inter))


#CRP Death
model_crp_death_inter <-(with(des, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race + pdeath_b*parent_ed + parent_ed*race+ pdeath_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_crp_death_inter))
MIcombineP(MIcombine(model_crp_death_inter))

#CRP Sep
model_crp_sep_inter <-(with(des, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race + psep_b*parent_ed + parent_ed*race+ psep_b*race*parent_ed, family=stats::gaussian())))
summary(MIcombine(model_crp_sep_inter))
MIcombineP(MIcombine(model_crp_sep_inter))



mitools.res<- summary(cmv_inter, conf.int=TRUE)
mitools.res<- cbind(mitools.res, df=mitools.fit$df)
mitools.res



#CMV 


model_cmv_death_inter <-(with(des, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race, family=stats::gaussian())))
summary(MIcombine(model_cmv_death_inter))
MIcombineP(MIcombine(model_cmv_death_inter))

model_cmv_sep_inter <-(with(des, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race, family=stats::gaussian())))
summary(MIcombine(model_cmv_sep_inter))
MIcombineP(MIcombine(model_cmv_sep_inter))



#TNF 



model_tnf_death_inter <-(with(des, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race, family=stats::gaussian())))
summary(MIcombine(model_tnf_death_inter))
MIcombineP(MIcombine(model_tnf_death_inter))


model_tnf_sep_inter <-(with(des, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race, family=stats::gaussian())))
summary(MIcombine(model_tnf_sep_inter))
MIcombineP(MIcombine(model_tnf_sep_inter))


##IL-6 




model_il6_death_inter <-(with(des, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race, family=stats::gaussian())))
summary(MIcombine(model_il6_death_inter))
MIcombineP(MIcombine(model_il6_death_inter))


model_il6_sep_inter <-(with(des, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race, family=stats::gaussian())))
summary(MIcombine(model_il6_sep_inter))
MIcombineP(MIcombine(model_il6_sep_inter))


## CRP 



model_crp_death_inter <-(with(des, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed + race + pdeath_b*race, family=stats::gaussian())))
summary(MIcombine(model_crp_death_inter))
MIcombineP(MIcombine(model_crp_death_inter))


model_crp_sep_inter <-(with(des, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed + race + psep_b*race, family=stats::gaussian())))
summary(MIcombine(model_crp_sep_inter))
MIcombineP(MIcombine(model_crp_sep_inter))



```

```{r}
##Stratified Models 


library(MASS)
library(survey)
library(mice)
library(stargazer)
library(texreg)
library(svyVGAM)
library(broom.mixed)
library(mitools)
library(survey)
library(Amelia)
library(ggplot2)
library(aod)
library(texreg)
library(miceadds)
library(mitools)
library(survey)
library(Amelia)
library(ggplot2)
library(aod)
library(texreg)
library(svyVGAM)



imp_list <- imputationList(lapply(1:imp$m, function(n) mice::complete(imp, action = n)))
des <- svydesign(ids=~hhidpn, weights=~PVBSWGTR,data=imp_list)

dsub_bl<-subset(des, race=="Non-Hispanic Black")
dsub_wh<-subset(des, race=="Non-Hispanic White")
dsub_his<-subset(des, race=="Hispanic")
dsub_other<-subset(des, race=="Other")



##NH-Blacks

##CMV Models
#First set of models; CMV and Parental Death



cmv_model1_bl <- with(dsub_bl, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model2_bl <- with(dsub_bl, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
 cmv_model3_bl <- with(dsub_bl, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(cmv_model1_bl)){
  tmp_obj <- cmv_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(cmv_model2_bl)){
  tmp_obj <- cmv_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(cmv_model3_bl)){
   tmp_obj <- cmv_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")

dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t

 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "CMV, Model 3")%>%
     add_column(Outcome = "CMV")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##CMV Models
#First set of models; CMV and Parental Death

cmv_model3_wh <- with(dsub_wh, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model4_wh <- with(dsub_wh, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
 cmv_model5_wh <- with(dsub_wh, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI,  family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(cmv_model3_wh)){
  tmp_obj <- cmv_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(cmv_model4_wh)){
  tmp_obj <- cmv_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Death")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(cmv_model5_wh)){
   tmp_obj <- cmv_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Death")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t
 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "CMV, Model 3")%>%
   add_column(Outcome = "CMV")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##CMV Models
# CMV and Parental Death

cmv_model5_his <- with(dsub_his, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model6_his <- with(dsub_his, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
cmv_model7_his <- with(dsub_his, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(cmv_model5_his)){
  tmp_obj <- cmv_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Death")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(cmv_model6_his)){
  tmp_obj <- cmv_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Death")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(cmv_model7_his)){
   tmp_obj <- cmv_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Death")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled901$qbar
pooled_est9[12,3] <- dpooled901$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "CMV, Model 3")%>%
   add_column(Outcome = "CMV")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##CMV Models
# CMV and Parental Death

cmv_model7_other <- with(dsub_other, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model8_other <- with(dsub_other, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
cmv_model9_other <- with(dsub_other, svyglm(ln_cmv~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(cmv_model7_other)){
  tmp_obj <- cmv_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Death")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(cmv_model8_other)){
  tmp_obj <- cmv_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Death")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(cmv_model9_other)){
   tmp_obj <- cmv_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Death")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t

 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "CMV, Model 3")%>%
   add_column(Outcome = "CMV")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Death")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Death")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Death")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Death")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Death")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Death")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Death")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Death")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Death")


  
model_total_cmv_death <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_cmv_death


model_cmv_regress_death <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

model_cmv_regress_death

write.csv(model_cmv_regress_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CMVModel_Strat_death.csv", row.names = FALSE)




plot1_cmv_death<-
  
  ggplot(data=model_total_cmv_death, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_cmv_death), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.2, 1.75))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_cmv_death$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_cmv_death





```

```{r}
##NH-Blacks

##CMV Models
# CMV and Parental Separation 



cmv_model1_bl <- with(dsub_bl, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model2_bl <- with(dsub_bl, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
 cmv_model3_bl <- with(dsub_bl, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(cmv_model1_bl)){
  tmp_obj <- cmv_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(cmv_model2_bl)){
  tmp_obj <- cmv_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(cmv_model3_bl)){
   tmp_obj <- cmv_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")

dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t


 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "CMV, Model 3")%>%
     add_column(Outcome = "CMV")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##CMV Models
#First set of models; CMV and Parental Death

cmv_model3_wh <- with(dsub_wh, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model4_wh <- with(dsub_wh, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
 cmv_model5_wh <- with(dsub_wh, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(cmv_model3_wh)){
  tmp_obj <- cmv_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(cmv_model4_wh)){
  tmp_obj <- cmv_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Separation")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(cmv_model5_wh)){
   tmp_obj <- cmv_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Separation")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)


pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t

 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "CMV, Model 3")%>%
   add_column(Outcome = "CMV")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##CMV Models
# CMV and Parental Death

cmv_model5_his <- with(dsub_his, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model6_his <- with(dsub_his, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
cmv_model7_his <- with(dsub_his, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(cmv_model5_his)){
  tmp_obj <- cmv_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Separation")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(cmv_model6_his)){
  tmp_obj <- cmv_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Separation")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(cmv_model7_his)){
   tmp_obj <- cmv_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Separation")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "CMV, Model 3")%>%
   add_column(Outcome = "CMV")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##CMV Models
# CMV and Parental Death

cmv_model7_other <- with(dsub_other, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
cmv_model8_other <- with(dsub_other, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
cmv_model9_other <- with(dsub_other, svyglm(ln_cmv~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(cmv_model7_other)){
  tmp_obj <- cmv_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Separation")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "CMV, Model 1")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(cmv_model8_other)){
  tmp_obj <- cmv_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Separation")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "CMV, Model 2")%>%
    add_column(Outcome = "CMV")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(cmv_model9_other)){
   tmp_obj <- cmv_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Separation")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t


 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "CMV, Model 3")%>%
   add_column(Outcome = "CMV")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Separation")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Separation")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Separation")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Separation")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Separation")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Separation")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Separation")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Separation")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Separation")


  
model_total_cmv_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_cmv_sep


model_cmv_regress_sep <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_cmv_regress_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CMVModel_Strat_sep.csv", row.names = FALSE)


plot1_cmv_sep<-
  
  ggplot(data=model_total_cmv_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_cmv_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.2, 2.0))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_cmv_sep$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_cmv_sep


```

```{r}

##NH-Blacks

##TNF Models
#First set of models; TNF and Parental Death



tnf_model1_bl <- with(dsub_bl, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model2_bl <- with(dsub_bl, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model3_bl <- with(dsub_bl, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(tnf_model1_bl)){
  tmp_obj <- tnf_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(tnf_model2_bl)){
  tmp_obj <- tnf_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(tnf_model3_bl)){
   tmp_obj <- tnf_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")

dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t

 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "sTNF, Model 3")%>%
     add_column(Outcome = "sTNF")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##TNF Models
#First set of models;TNF and Parental Death

tnf_model3_wh <- with(dsub_wh, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model4_wh <- with(dsub_wh, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model5_wh <- with(dsub_wh, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(tnf_model3_wh)){
  tmp_obj <- tnf_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(tnf_model4_wh)){
  tmp_obj <- tnf_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Death")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(tnf_model5_wh)){
   tmp_obj <- tnf_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI" )
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Death")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")


dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t
 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "sTNF, Model 3")%>%
   add_column(Outcome = "sTNF")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##CMV Models
# CMV and Parental Death

tnf_model5_his <- with(dsub_his, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model6_his <- with(dsub_his, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model7_his <- with(dsub_his, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(tnf_model5_his)){
  tmp_obj <- tnf_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Death")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(tnf_model6_his)){
  tmp_obj <- tnf_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Death")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(tnf_model7_his)){
   tmp_obj <- tnf_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Death")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "sTNF, Model 3")%>%
   add_column(Outcome = "sTNF")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##CMV Models
# CMV and Parental Death

tnf_model7_other <- with(dsub_other, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model8_other <- with(dsub_other, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model9_other <- with(dsub_other, svyglm(ln_tnf~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(tnf_model7_other)){
  tmp_obj <- tnf_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Death")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(tnf_model8_other)){
  tmp_obj <- tnf_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Death")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(tnf_model9_other)){
   tmp_obj <- tnf_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Death")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t


 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "sTNF, Model 3")%>%
   add_column(Outcome = "sTNF")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Death")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Death")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Death")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Death")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Death")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Death")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Death")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Death")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Death")


  
model_total_tnf_death <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_tnf_death


model_tnf_regress_death <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_tnf_regress_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\TNFModel_Strat_death.csv", row.names = FALSE)


plot1_tnf_death<-
  
  ggplot(data=model_total_tnf_death, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_tnf_death), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.1))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_tnf_death$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_tnf_death


```

```{r}

##NH-Blacks

##TNF Models
#First set of models; TNF and Parental Separation



tnf_model1_bl <- with(dsub_bl, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model2_bl <- with(dsub_bl, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model3_bl <- with(dsub_bl, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(tnf_model1_bl)){
  tmp_obj <- tnf_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(tnf_model2_bl)){
  tmp_obj <- tnf_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(tnf_model3_bl)){
   tmp_obj <- tnf_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")

dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t


 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "sTNF, Model 3")%>%
     add_column(Outcome = "sTNF")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##TNF Models
#First set of models;TNF and Parental Separation

tnf_model3_wh <- with(dsub_wh, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model4_wh <- with(dsub_wh, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model5_wh <- with(dsub_wh, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(tnf_model3_wh)){
  tmp_obj <- tnf_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(tnf_model4_wh)){
  tmp_obj <- tnf_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Separation")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(tnf_model5_wh)){
   tmp_obj <- tnf_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Separation")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t

 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "sTNF, Model 3")%>%
   add_column(Outcome = "sTNF")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##TNF Models
# TNF and Parental Sep

tnf_model5_his <- with(dsub_his, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model6_his <- with(dsub_his, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model7_his <- with(dsub_his, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(tnf_model5_his)){
  tmp_obj <- tnf_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Separation")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(tnf_model6_his)){
  tmp_obj <- tnf_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Separation")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(tnf_model7_his)){
   tmp_obj <- tnf_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Separation")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)


pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "sTNF, Model 3")%>%
   add_column(Outcome = "sTNF")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##TNF Models
# TNF and Parental Sep

tnf_model7_other <- with(dsub_other, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
tnf_model8_other <- with(dsub_other, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
tnf_model9_other <- with(dsub_other, svyglm(ln_tnf~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(tnf_model7_other)){
  tmp_obj <- tnf_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Separation")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "sTNF, Model 1")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(tnf_model8_other)){
  tmp_obj <- tnf_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Separation")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "sTNF, Model 2")%>%
    add_column(Outcome = "sTNF")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(tnf_model9_other)){
   tmp_obj <- tnf_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Separation")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t


 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "sTNF, Model 3")%>%
   add_column(Outcome = "sTNF")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Separation")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Separation")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Separation")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Separation")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Separation")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Separation")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Separation")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Separation")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Separation")


  
model_total_tnf_sep<-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_tnf_sep


model_tnf_regress_sep<-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_tnf_regress_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\TNFModel_Strat_sep.csv", row.names = FALSE)



plot1_tnf_sep<-
  
  ggplot(data=model_total_tnf_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_tnf_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.9, 1.1))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_tnf_sep$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_tnf_sep
```

```{r}
##NH-Blacks

##IL6 Models
#First set of models; IL-6 and Parental Death



il6_model1_bl <- with(dsub_bl, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model2_bl <- with(dsub_bl, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model3_bl <- with(dsub_bl, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(il6_model1_bl)){
  tmp_obj <- il6_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(il6_model2_bl)){
  tmp_obj <- il6_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(il6_model3_bl)){
   tmp_obj <- il6_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")

dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t

 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "IL-6, Model 3")%>%
     add_column(Outcome = "IL-6")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##Il-6 Models
#First set of models;IL-6 and Parental Death

il6_model3_wh <- with(dsub_wh, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model4_wh <- with(dsub_wh, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model5_wh <- with(dsub_wh, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(il6_model3_wh)){
  tmp_obj <- il6_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(il6_model4_wh)){
  tmp_obj <- il6_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Death")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(il6_model5_wh)){
   tmp_obj <- il6_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Death")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t
 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "IL-6, Model 3")%>%
   add_column(Outcome = "IL-6")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##IL-6 Models
# IL-6 and Parental Death

il6_model5_his <- with(dsub_his, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model6_his <- with(dsub_his, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model7_his <- with(dsub_his, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(il6_model5_his)){
  tmp_obj <- il6_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Death")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(il6_model6_his)){
  tmp_obj <- il6_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Death")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(il6_model7_his)){
   tmp_obj <- il6_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Death")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "IL-6, Model 3")%>%
   add_column(Outcome = "IL-6")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##IL-6  Models
# IL-6 and Parental Death

il6_model7_other <- with(dsub_other, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model8_other <- with(dsub_other, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model9_other <- with(dsub_other, svyglm(ln_il6~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(il6_model7_other)){
  tmp_obj <- il6_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Death")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(il6_model8_other)){
  tmp_obj <- il6_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Death")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(il6_model9_other)){
   tmp_obj <- il6_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Death")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t



 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "IL-6, Model 3")%>%
   add_column(Outcome = "IL-6")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Death")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Death")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Death")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Death")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Death")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Death")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Death")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Death")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Death")


  
model_total_il6_death <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_il6_death


model_il6_regress_death <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_il6_regress_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\IL6Model_Strat_death.csv", row.names = FALSE)




plot1_il6_death<-
  
  ggplot(data=model_total_il6_death, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_il6_death), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.75, 1.25))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_il6_death$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_il6_death
```

```{r}
##NH-Blacks

##IL6 Models
#First set of models; IL-6 and Parental Separation 



il6_model1_bl <- with(dsub_bl, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model2_bl <- with(dsub_bl, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model3_bl <- with(dsub_bl, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(il6_model1_bl)){
  tmp_obj <- il6_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(il6_model2_bl)){
  tmp_obj <- il6_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(il6_model3_bl)){
   tmp_obj <- il6_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")

dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t

 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "IL-6, Model 3")%>%
     add_column(Outcome = "IL-6")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##Il-6 Models
#First set of models;IL-6 and Parental Sep

il6_model3_wh <- with(dsub_wh, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model4_wh <- with(dsub_wh, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model5_wh <- with(dsub_wh, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(il6_model3_wh)){
  tmp_obj <- il6_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(il6_model4_wh)){
  tmp_obj <- il6_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Separation")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(il6_model5_wh)){
   tmp_obj <- il6_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Separation")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t

 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "IL-6, Model 3")%>%
   add_column(Outcome = "IL-6")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##IL-6 Models
# IL-6 and Parental Sep

il6_model5_his <- with(dsub_his, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model6_his <- with(dsub_his, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model7_his <- with(dsub_his, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(il6_model5_his)){
  tmp_obj <- il6_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Separation")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(il6_model6_his)){
  tmp_obj <- il6_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Separation")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(il6_model7_his)){
   tmp_obj <- il6_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations", "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Separation")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "IL-6, Model 3")%>%
   add_column(Outcome = "IL-6")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##IL-6 Models
# IL-6 and Parental Sep

il6_model7_other <- with(dsub_other, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
il6_model8_other <- with(dsub_other, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
il6_model9_other <- with(dsub_other, svyglm(ln_il6~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI , family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(il6_model7_other)){
  tmp_obj <- il6_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Separation")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "IL-6, Model 1")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(il6_model8_other)){
  tmp_obj <- il6_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Separation")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "IL-6, Model 2")%>%
    add_column(Outcome = "IL-6")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(il6_model9_other)){
   tmp_obj <- il6_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Separation")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t


 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "IL-6, Model 3")%>%
   add_column(Outcome = "IL-6")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Separation")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Separation")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Separation")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Separation")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Separation")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Separation")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Separation")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Separation")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Separation")


  
model_total_il6_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_il6_sep


model_il6_regress_sep <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_il6_regress_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\IL6Model_Strat_sep.csv", row.names = FALSE)


plot1_il6_sep<-
  
  ggplot(data=model_total_il6_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_il6_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.75, 1.25))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_il6_sep$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_il6_sep
```

```{r}
##NH-Blacks

##CRP Models
#First set of models; CRP and Parental Death



crp_model1_bl <- with(dsub_bl, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model2_bl <- with(dsub_bl, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model3_bl <- with(dsub_bl, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(crp_model1_bl)){
  tmp_obj <- crp_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Death")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(crp_model2_bl)){
  tmp_obj <- crp_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Death")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(crp_model3_bl)){
   tmp_obj <- crp_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Death")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t

 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "CRP, Model 3")%>%
     add_column(Outcome = "CRP")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##CRP Models
#First set of models;CRP and Parental Death

crp_model3_wh <- with(dsub_wh, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model4_wh <- with(dsub_wh, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model5_wh <- with(dsub_wh, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(crp_model3_wh)){
  tmp_obj <- crp_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Death")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(crp_model4_wh)){
  tmp_obj <- crp_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Death")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(crp_model5_wh)){
   tmp_obj <- crp_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Death")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t

 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "CRP, Model 3")%>%
   add_column(Outcome = "CRP")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##CRP Models
#CRP and Parental Death

crp_model5_his <- with(dsub_his, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model6_his <- with(dsub_his, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model7_his <- with(dsub_his, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(crp_model5_his)){
  tmp_obj <- crp_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Death")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(crp_model6_his)){
  tmp_obj <- crp_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Death")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(crp_model7_his)){
   tmp_obj <- crp_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Death")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")

dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t

 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "CRP, Model 3")%>%
   add_column(Outcome = "CRP")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##CRP Models
# CRP and Parental Death

crp_model7_other <- with(dsub_other, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model8_other <- with(dsub_other, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model9_other <- with(dsub_other, svyglm(ln_crp~ pdeath_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(crp_model7_other)){
  tmp_obj <- crp_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Death")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(crp_model8_other)){
  tmp_obj <- crp_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Death")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(crp_model9_other)){
   tmp_obj <- crp_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Death", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Death")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t



 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "CRP, Model 3")%>%
   add_column(Outcome = "CRP")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Death")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Death")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Death")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Death")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Death")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Death")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Death")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Death")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Death")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Death")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Death")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Death")


  
model_total_crp_death <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_crp_death


model_crp_regress_death <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_crp_regress_death,"C:\\LOCATION OF FOLDERS\Tables\\Tables from R\\CRPModel_Strat_death.csv", row.names = FALSE)


plot1_crp_death<-
  
  ggplot(data=model_total_crp_death, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_crp_death), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.75, 1.25))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_crp_death$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_crp_death
```

```{r}
##NH-Blacks

##CRP Models
#First set of models; CRP and Parental Separation



crp_model1_bl <- with(dsub_bl, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model2_bl <- with(dsub_bl, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model3_bl <- with(dsub_bl, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
blmodel1_list <- list()
for(i in 1:length(crp_model1_bl)){
  tmp_obj <- crp_model1_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel1_list[[i]] <- tmp
  
}


blmod1_reslong <- bind_rows(blmodel1_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
blmod1_reslong$var <- rep(varnames,5)


death_pool11 <- filter(blmod1_reslong, var=="Intercept")
death_pool12 <- filter(blmod1_reslong, var=="Experienced Parental Separation")
death_pool13 <- filter(blmod1_reslong, var=="Age")
death_pool14 <- filter(blmod1_reslong, var=="Gender")


dpooled11 <- pool.scalar(death_pool11$coef, death_pool11$vari)
dpooled12 <- pool.scalar(death_pool12$coef, death_pool12$vari)
dpooled13 <- pool.scalar(death_pool13$coef, death_pool13$vari)
dpooled14 <- pool.scalar(death_pool14$coef, death_pool14$vari)

pooled_est1 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est1[1,2] <- dpooled11$qbar
pooled_est1[1,3] <- dpooled11$t

pooled_est1[2,2] <- dpooled12$qbar
pooled_est1[2,3] <- dpooled12$t

pooled_est1[3,2] <- dpooled13$qbar
pooled_est1[3,3] <- dpooled13$t

pooled_est1[4,2] <- dpooled14$qbar
pooled_est1[4,3] <- dpooled14$t

blmodel1_pooled <- pooled_est1 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel1_pooled$se <- sqrt(blmodel1_pooled$vari)
blmodel1_pooled$ll <- blmodel1_pooled$coef - (1.96*blmodel1_pooled$se) 
blmodel1_pooled$ul <- (1.96*blmodel1_pooled$se) + blmodel1_pooled$coef 
blmodel1_pooled$exp_est <- exp(blmodel1_pooled$coef)
blmodel1_pooled$exp_ll <-  exp(blmodel1_pooled$ll)
blmodel1_pooled$exp_ul <-  exp(blmodel1_pooled$ul)

blmodel1_pooled


## Model 2
blmodel2_list <- list()
for(i in 1:length(crp_model2_bl)){
  tmp_obj <- crp_model2_bl[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  blmodel2_list[[i]] <- tmp
  
}


blmod2_reslong <- bind_rows(blmodel2_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
blmod2_reslong$var <- rep(varnames,5)


death_pool21 <- filter(blmod2_reslong, var=="Intercept")
death_pool22 <- filter(blmod2_reslong, var=="Experienced Parental Separation")
death_pool23 <- filter(blmod2_reslong, var=="Age")
death_pool24 <- filter(blmod2_reslong, var=="Gender")
death_pool25 <- filter(blmod2_reslong, var=="Parental Education")


dpooled21 <- pool.scalar(death_pool21$coef, death_pool21$vari)
dpooled22 <- pool.scalar(death_pool22$coef, death_pool22$vari)
dpooled23 <- pool.scalar(death_pool23$coef, death_pool23$vari)
dpooled24 <- pool.scalar(death_pool24$coef, death_pool24$vari)
dpooled25 <- pool.scalar(death_pool25$coef, death_pool25$vari)


pooled_est2 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est2[1,2] <- dpooled21$qbar
pooled_est2[1,3] <- dpooled21$t

pooled_est2[2,2] <- dpooled22$qbar
pooled_est2[2,3] <- dpooled22$t

pooled_est2[3,2] <- dpooled23$qbar
pooled_est2[3,3] <- dpooled23$t

pooled_est2[4,2] <- dpooled24$qbar
pooled_est2[4,3] <- dpooled24$t

pooled_est2[5,2] <- dpooled25$qbar
pooled_est2[5,3] <- dpooled25$t

blmodel2_pooled <- pooled_est2 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic Black")

blmodel2_pooled$se <- sqrt(blmodel2_pooled$vari)
blmodel2_pooled$ll <- blmodel2_pooled$coef - (1.96*blmodel2_pooled$se) 
blmodel2_pooled$ul <- (1.96*blmodel2_pooled$se) + blmodel2_pooled$coef 
blmodel2_pooled$exp_est <- exp(blmodel2_pooled$coef)
blmodel2_pooled$exp_ll <-  exp(blmodel2_pooled$ll)
blmodel2_pooled$exp_ul <-  exp(blmodel2_pooled$ul)



# ## Model 3
# 
 blmodel3_list <- list()
 for(i in 1:length(crp_model3_bl)){
   tmp_obj <- crp_model3_bl[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   blmodel3_list[[i]] <- tmp
   
 }
 
 
 blmod3_reslong <- bind_rows(blmodel3_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 blmod3_reslong$var <- rep(varnames,100)

 
death_pool31 <- filter(blmod3_reslong, var=="Intercept")
death_pool32 <- filter(blmod3_reslong, var=="Experienced Parental Separation")
death_pool33 <- filter(blmod3_reslong, var=="Age")
death_pool34 <- filter(blmod3_reslong, var=="Gender")
death_pool35 <- filter(blmod3_reslong, var=="Parental Education")
death_pool36 <- filter(blmod3_reslong, var=="Education")
death_pool37 <- filter(blmod3_reslong, var=="Smoking Status")
death_pool38 <- filter(blmod3_reslong, var=="Change in Self-Reported Health")
death_pool39 <- filter(blmod3_reslong, var=="Self-Report of Health Change")
death_pool300 <- filter(blmod3_reslong, var=="Chronic Condition Index")
death_pool301 <- filter(blmod3_reslong, var=="Change in Functional Limitations")
death_pool302 <- filter(blmod3_reslong, var=="BMI")


dpooled31 <- pool.scalar(death_pool31$coef, death_pool31$vari)
dpooled32 <- pool.scalar(death_pool32$coef, death_pool32$vari)
dpooled33 <- pool.scalar(death_pool33$coef, death_pool33$vari)
dpooled34 <- pool.scalar(death_pool34$coef, death_pool34$vari)
dpooled35 <- pool.scalar(death_pool35$coef, death_pool35$vari)
dpooled36 <- pool.scalar(death_pool36$coef, death_pool36$vari)
dpooled37 <- pool.scalar(death_pool37$coef, death_pool37$vari)
dpooled38 <- pool.scalar(death_pool38$coef, death_pool38$vari)
dpooled39 <- pool.scalar(death_pool39$coef, death_pool39$vari)
dpooled300 <- pool.scalar(death_pool300$coef, death_pool300$vari)
dpooled301 <- pool.scalar(death_pool301$coef, death_pool301$vari)
dpooled302 <- pool.scalar(death_pool302$coef, death_pool302$vari)

pooled_est3 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est3[1,2]=dpooled31$qbar
pooled_est3[1,3]=dpooled31$t
pooled_est3[2,2] <- dpooled32$qbar
pooled_est3[2,3] <- dpooled32$t
pooled_est3[3,2] <- dpooled33$qbar
pooled_est3[3,3] <- dpooled33$t
pooled_est3[4,2] <- dpooled34$qbar
pooled_est3[4,3] <- dpooled34$t
pooled_est3[5,2] <- dpooled35$qbar
pooled_est3[5,3] <- dpooled35$t
pooled_est3[6,2] <- dpooled36$qbar
pooled_est3[6,3] <- dpooled36$t
pooled_est3[7,2] <- dpooled37$qbar
pooled_est3[7,3] <- dpooled37$t
pooled_est3[8,2] <- dpooled38$qbar
pooled_est3[8,3] <- dpooled38$t
pooled_est3[9,2] <- dpooled39$qbar
pooled_est3[9,3] <- dpooled39$t
pooled_est3[10,2] <- dpooled300$qbar
pooled_est3[10,3] <- dpooled300$t
pooled_est3[11,2] <- dpooled301$qbar
pooled_est3[11,3] <- dpooled301$t
pooled_est3[12,2] <- dpooled302$qbar
pooled_est3[12,3] <- dpooled302$t

 
 blmodel3_pooled <- pooled_est3 %>% 
     add_column(Model = "CRP, Model 3")%>%
     add_column(Outcome = "CRP")%>%
     add_column(Race = "Non-Hispanic Black")
 
 blmodel3_pooled$se <- sqrt(blmodel3_pooled$vari)
 blmodel3_pooled$ll <- blmodel3_pooled$coef - (1.96*blmodel3_pooled$se) 
 blmodel3_pooled$ul <- (1.96*blmodel3_pooled$se) + blmodel3_pooled$coef 
 blmodel3_pooled$exp_est <- exp(blmodel3_pooled$coef)
 blmodel3_pooled$exp_ll <-  exp(blmodel3_pooled$ll)
 blmodel3_pooled$exp_ul <-  exp(blmodel3_pooled$ul)



##NH-Whites

##CRP Models
#First set of models;CRP and Parental Sep

crp_model3_wh <- with(dsub_wh, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model4_wh <- with(dsub_wh, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model5_wh <- with(dsub_wh, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
whmodel4_list <- list()
for(i in 1:length(crp_model3_wh)){
  tmp_obj <- crp_model3_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel4_list[[i]] <- tmp
  
}


whmod4_reslong <- bind_rows(whmodel4_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
whmod4_reslong$var <- rep(varnames,5)

death_pool41 <- filter(whmod4_reslong, var=="Intercept")
death_pool42 <- filter(whmod4_reslong, var=="Experienced Parental Separation")
death_pool43 <- filter(whmod4_reslong, var=="Age")
death_pool44 <- filter(whmod4_reslong, var=="Gender")


dpooled41 <- pool.scalar(death_pool41$coef, death_pool41$vari)
dpooled42 <- pool.scalar(death_pool42$coef, death_pool42$vari)
dpooled43 <- pool.scalar(death_pool43$coef, death_pool43$vari)
dpooled44 <- pool.scalar(death_pool44$coef, death_pool44$vari)


pooled_est4 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))

pooled_est4[1,2] <- dpooled41$qbar
pooled_est4[1,3] <- dpooled41$t

pooled_est4[2,2] <- dpooled42$qbar
pooled_est4[2,3] <- dpooled42$t

pooled_est4[3,2] <- dpooled43$qbar
pooled_est4[3,3] <- dpooled43$t

pooled_est4[4,2] <- dpooled44$qbar
pooled_est4[4,3] <- dpooled44$t

whmodel4_pooled <- pooled_est4 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic White")

whmodel4_pooled$se <- sqrt(whmodel4_pooled$vari)
whmodel4_pooled$ll <- whmodel4_pooled$coef - (1.96*whmodel4_pooled$se) 
whmodel4_pooled$ul <- (1.96*whmodel4_pooled$se) + whmodel4_pooled$coef 
whmodel4_pooled$exp_est <- exp(whmodel4_pooled$coef)
whmodel4_pooled$exp_ll <-  exp(whmodel4_pooled$ll)
whmodel4_pooled$exp_ul <-  exp(whmodel4_pooled$ul)




## Model 2
whmodel5_list <- list()
for(i in 1:length(crp_model4_wh)){
  tmp_obj <- crp_model4_wh[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  whmodel5_list[[i]] <- tmp
  
}


whmod5_reslong <- bind_rows(whmodel5_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
whmod5_reslong$var <- rep(varnames,5)



death_pool51 <- filter(whmod5_reslong, var=="Intercept")
death_pool52 <- filter(whmod5_reslong, var=="Experienced Parental Separation")
death_pool53 <- filter(whmod5_reslong, var=="Age")
death_pool54 <- filter(whmod5_reslong, var=="Gender")
death_pool55 <- filter(whmod5_reslong, var=="Parental Education")



dpooled51 <- pool.scalar(death_pool51$coef, death_pool51$vari)
dpooled52 <- pool.scalar(death_pool52$coef, death_pool52$vari)
dpooled53 <- pool.scalar(death_pool53$coef, death_pool53$vari)
dpooled54 <- pool.scalar(death_pool54$coef, death_pool54$vari)
dpooled55 <- pool.scalar(death_pool55$coef, death_pool55$vari)

pooled_est5 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est5[1,2] <- dpooled51$qbar
pooled_est5[1,3] <- dpooled51$t

pooled_est5[2,2] <- dpooled52$qbar
pooled_est5[2,3] <- dpooled52$t

pooled_est5[3,2] <- dpooled53$qbar
pooled_est5[3,3] <- dpooled53$t

pooled_est5[4,2] <- dpooled54$qbar
pooled_est5[4,3] <- dpooled54$t

pooled_est5[5,2] <- dpooled55$qbar
pooled_est5[5,3] <- dpooled55$t



whmodel5_pooled <- pooled_est5 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Non-Hispanic White")

whmodel5_pooled$se <- sqrt(whmodel5_pooled$vari)
whmodel5_pooled$ll <- whmodel5_pooled$coef - (1.96*whmodel5_pooled$se) 
whmodel5_pooled$ul <- (1.96*whmodel5_pooled$se) + whmodel5_pooled$coef 
whmodel5_pooled$exp_est <- exp(whmodel5_pooled$coef)
whmodel5_pooled$exp_ll <-  exp(whmodel5_pooled$ll)
whmodel5_pooled$exp_ul <-  exp(whmodel5_pooled$ul)

 
# #Model 3
 
 whmodel6_list <- list()
 for(i in 1:length(crp_model5_wh)){
   tmp_obj <- crp_model5_wh[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   whmodel6_list[[i]] <- tmp
   
 }

 
 whmod6_reslong <- bind_rows(whmodel6_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 whmod6_reslong$var <- rep(varnames,100)
 
 

death_pool61 <- filter(whmod6_reslong, var=="Intercept")
death_pool62 <- filter(whmod6_reslong, var=="Experienced Parental Separation")
death_pool63 <- filter(whmod6_reslong, var=="Age")
death_pool64 <- filter(whmod6_reslong, var=="Gender")
death_pool65 <- filter(whmod6_reslong, var=="Parental Education")
death_pool66 <- filter(whmod6_reslong, var=="Education")
death_pool67 <- filter(whmod6_reslong, var=="Smoking Status")
death_pool68 <- filter(whmod6_reslong, var=="Change in Self-Reported Health")
death_pool69 <- filter(whmod6_reslong, var=="Self-Report of Health Change")
death_pool600 <- filter(whmod6_reslong, var=="Chronic Condition Index")
death_pool601 <- filter(whmod6_reslong, var=="Change in Functional Limitations")
death_pool602 <- filter(whmod6_reslong, var=="BMI")

dpooled61 <- pool.scalar(death_pool61$coef, death_pool61$vari)
dpooled62 <- pool.scalar(death_pool62$coef, death_pool62$vari)
dpooled63 <- pool.scalar(death_pool63$coef, death_pool63$vari)
dpooled64 <- pool.scalar(death_pool64$coef, death_pool64$vari)
dpooled65 <- pool.scalar(death_pool65$coef, death_pool65$vari)
dpooled66 <- pool.scalar(death_pool66$coef, death_pool66$vari)
dpooled67 <- pool.scalar(death_pool67$coef, death_pool67$vari)
dpooled68 <- pool.scalar(death_pool68$coef, death_pool68$vari)
dpooled69 <- pool.scalar(death_pool69$coef, death_pool69$vari)
dpooled600 <- pool.scalar(death_pool600$coef, death_pool600$vari)
dpooled601 <- pool.scalar(death_pool601$coef, death_pool601$vari)
dpooled602 <- pool.scalar(death_pool602$coef, death_pool602$vari)

pooled_est6 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est6[1,2]=dpooled61$qbar
pooled_est6[1,3]=dpooled61$t
pooled_est6[2,2] <- dpooled62$qbar
pooled_est6[2,3] <- dpooled62$t
pooled_est6[3,2] <- dpooled63$qbar
pooled_est6[3,3] <- dpooled63$t
pooled_est6[4,2] <- dpooled64$qbar
pooled_est6[4,3] <- dpooled64$t
pooled_est6[5,2] <- dpooled65$qbar
pooled_est6[5,3] <- dpooled65$t
pooled_est6[6,2] <- dpooled66$qbar
pooled_est6[6,3] <- dpooled66$t
pooled_est6[7,2] <- dpooled67$qbar
pooled_est6[7,3] <- dpooled67$t
pooled_est6[8,2] <- dpooled68$qbar
pooled_est6[8,3] <- dpooled68$t
pooled_est6[9,2] <- dpooled69$qbar
pooled_est6[9,3] <- dpooled69$t
pooled_est6[10,2] <- dpooled600$qbar
pooled_est6[10,3] <- dpooled600$t
pooled_est6[11,2] <- dpooled601$qbar
pooled_est6[11,3] <- dpooled601$t
pooled_est6[12,2] <- dpooled602$qbar
pooled_est6[12,3] <- dpooled602$t

 

whmodel6_pooled <- pooled_est6 %>% 
   add_column(Model = "CRP, Model 3")%>%
   add_column(Outcome = "CRP")%>%
   add_column(Race = "Non-Hispanic White")
# 
 whmodel6_pooled$se <- sqrt(whmodel6_pooled$vari)
 whmodel6_pooled$ll <- whmodel6_pooled$coef - (1.96*whmodel6_pooled$se) 
 whmodel6_pooled$ul <- (1.96*whmodel6_pooled$se) + whmodel6_pooled$coef 
 whmodel6_pooled$exp_est <- exp(whmodel6_pooled$coef)
 whmodel6_pooled$exp_ll <-  exp(whmodel6_pooled$ll)
 whmodel6_pooled$exp_ul <-  exp(whmodel6_pooled$ul)
# 
# 
# 
# 

##Hispanic 

##CRP Models
# CRP and Parental Sep

crp_model5_his <- with(dsub_his, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model6_his <- with(dsub_his, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model7_his <- with(dsub_his, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC + R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
hismodel7_list <- list()
for(i in 1:length(crp_model5_his)){
  tmp_obj <- crp_model5_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel7_list[[i]] <- tmp
  
}


hismod7_reslong <- bind_rows(hismodel7_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
hismod7_reslong$var <- rep(varnames,5)


death_pool71 <- filter(hismod7_reslong, var=="Intercept")
death_pool72 <- filter(hismod7_reslong, var=="Experienced Parental Separation")
death_pool73 <- filter(hismod7_reslong, var=="Age")
death_pool74 <- filter(hismod7_reslong, var=="Gender")

dpooled71 <- pool.scalar(death_pool71$coef, death_pool71$vari)
dpooled72 <- pool.scalar(death_pool72$coef, death_pool72$vari)
dpooled73 <- pool.scalar(death_pool73$coef, death_pool73$vari)
dpooled74 <- pool.scalar(death_pool74$coef, death_pool74$vari)

pooled_est7 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est7[1,2] <- dpooled71$qbar
pooled_est7[1,3] <- dpooled71$t

pooled_est7[2,2] <- dpooled72$qbar
pooled_est7[2,3] <- dpooled72$t

pooled_est7[3,2] <- dpooled73$qbar
pooled_est7[3,3] <- dpooled73$t

pooled_est7[4,2] <- dpooled74$qbar
pooled_est7[4,3] <- dpooled74$t


hismodel7_pooled <- pooled_est7 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Hispanic")

hismodel7_pooled$se <- sqrt(hismodel7_pooled$vari)
hismodel7_pooled$ll <- hismodel7_pooled$coef - (1.96*hismodel7_pooled$se) 
hismodel7_pooled$ul <- (1.96*hismodel7_pooled$se) + hismodel7_pooled$coef 
hismodel7_pooled$exp_est <- exp(hismodel7_pooled$coef)
hismodel7_pooled$exp_ll <-  exp(hismodel7_pooled$ll)
hismodel7_pooled$exp_ul <-  exp(hismodel7_pooled$ul)




## Model 2
hismodel8_list <- list()
for(i in 1:length(crp_model6_his)){
  tmp_obj <- crp_model6_his[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  hismodel8_list[[i]] <- tmp
  
}


hismod8_reslong <- bind_rows(hismodel8_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
hismod8_reslong$var <- rep(varnames,5)


death_pool81 <- filter(hismod8_reslong, var=="Intercept")
death_pool82 <- filter(hismod8_reslong, var=="Experienced Parental Separation")
death_pool83 <- filter(hismod8_reslong, var=="Age")
death_pool84 <- filter(hismod8_reslong, var=="Gender")
death_pool85 <- filter(hismod8_reslong, var=="Parental Education")


dpooled81 <- pool.scalar(death_pool81$coef, death_pool81$vari)
dpooled82 <- pool.scalar(death_pool82$coef, death_pool82$vari)
dpooled83 <- pool.scalar(death_pool83$coef, death_pool83$vari)
dpooled84 <- pool.scalar(death_pool84$coef, death_pool84$vari)
dpooled85 <- pool.scalar(death_pool85$coef, death_pool85$vari)

pooled_est8 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))

pooled_est8[1,2] <- dpooled81$qbar
pooled_est8[1,3] <- dpooled81$t

pooled_est8[2,2] <- dpooled82$qbar
pooled_est8[2,3] <- dpooled82$t

pooled_est8[3,2] <- dpooled83$qbar
pooled_est8[3,3] <- dpooled83$t

pooled_est8[4,2] <- dpooled84$qbar
pooled_est8[4,3] <- dpooled84$t

pooled_est8[5,2] <- dpooled85$qbar
pooled_est8[5,3] <- dpooled85$t






hismodel8_pooled <- pooled_est8 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Hispanic")

hismodel8_pooled$se <- sqrt(hismodel8_pooled$vari)
hismodel8_pooled$ll <- hismodel8_pooled$coef - (1.96*hismodel8_pooled$se) 
hismodel8_pooled$ul <- (1.96*hismodel8_pooled$se) + hismodel8_pooled$coef 
hismodel8_pooled$exp_est <- exp(hismodel8_pooled$coef)
hismodel8_pooled$exp_ll <-  exp(hismodel8_pooled$ll)
hismodel8_pooled$exp_ul <-  exp(hismodel8_pooled$ul)

# 
# #Model 3 

 
 hismodel9_list <- list()
 for(i in 1:length(crp_model7_his)){
   tmp_obj <- crp_model7_his[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   hismodel9_list[[i]] <- tmp
   
 }
 
 
 hismod9_reslong <- bind_rows(hismodel9_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 hismod9_reslong$var <- rep(varnames,100)
 

death_pool91 <- filter(hismod9_reslong, var=="Intercept")
death_pool92 <- filter(hismod9_reslong, var=="Experienced Parental Separation")
death_pool93 <- filter(hismod9_reslong, var=="Age")
death_pool94 <- filter(hismod9_reslong, var=="Gender")
death_pool95 <- filter(hismod9_reslong, var=="Parental Education")
death_pool96 <- filter(hismod9_reslong, var=="Education")
death_pool97 <- filter(hismod9_reslong, var=="Smoking Status")
death_pool98 <- filter(hismod9_reslong, var=="Change in Self-Reported Health")
death_pool99 <- filter(hismod9_reslong, var=="Self-Report of Health Change")
death_pool900 <- filter(hismod9_reslong, var=="Chronic Condition Index")
death_pool901 <- filter(hismod9_reslong, var=="Change in Functional Limitations")
death_pool902 <- filter(hismod9_reslong, var=="BMI")


dpooled91 <- pool.scalar(death_pool91$coef, death_pool91$vari)
dpooled92 <- pool.scalar(death_pool92$coef, death_pool92$vari)
dpooled93 <- pool.scalar(death_pool93$coef, death_pool93$vari)
dpooled94 <- pool.scalar(death_pool94$coef, death_pool94$vari)
dpooled95 <- pool.scalar(death_pool95$coef, death_pool95$vari)
dpooled96 <- pool.scalar(death_pool96$coef, death_pool96$vari)
dpooled97 <- pool.scalar(death_pool97$coef, death_pool97$vari)
dpooled98 <- pool.scalar(death_pool98$coef, death_pool98$vari)
dpooled99 <- pool.scalar(death_pool99$coef, death_pool99$vari)
dpooled900 <- pool.scalar(death_pool900$coef, death_pool900$vari)
dpooled901 <- pool.scalar(death_pool901$coef, death_pool901$vari)
dpooled902 <- pool.scalar(death_pool902$coef, death_pool902$vari)

pooled_est9 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est9[1,2]=dpooled91$qbar
pooled_est9[1,3]=dpooled91$t
pooled_est9[2,2] <- dpooled92$qbar
pooled_est9[2,3] <- dpooled92$t
pooled_est9[3,2] <- dpooled93$qbar
pooled_est9[3,3] <- dpooled93$t
pooled_est9[4,2] <- dpooled94$qbar
pooled_est9[4,3] <- dpooled94$t
pooled_est9[5,2] <- dpooled95$qbar
pooled_est9[5,3] <- dpooled95$t
pooled_est9[6,2] <- dpooled96$qbar
pooled_est9[6,3] <- dpooled96$t
pooled_est9[7,2] <- dpooled97$qbar
pooled_est9[7,3] <- dpooled97$t
pooled_est9[8,2] <- dpooled98$qbar
pooled_est9[8,3] <- dpooled98$t
pooled_est9[9,2] <- dpooled99$qbar
pooled_est9[9,3] <- dpooled99$t
pooled_est9[10,2] <- dpooled900$qbar
pooled_est9[10,3] <- dpooled900$t
pooled_est9[11,2] <- dpooled901$qbar
pooled_est9[11,3] <- dpooled901$t
pooled_est9[12,2] <- dpooled902$qbar
pooled_est9[12,3] <- dpooled902$t


 hismodel9_pooled <- pooled_est9 %>% 
   add_column(Model = "CRP, Model 3")%>%
   add_column(Outcome = "CRP")%>%
   add_column(Race = "Hispanic")
 
 hismodel9_pooled$se <- sqrt(hismodel9_pooled$vari)
 hismodel9_pooled$ll <- hismodel9_pooled$coef - (1.96*hismodel9_pooled$se) 
 hismodel9_pooled$ul <- (1.96*hismodel9_pooled$se) + hismodel9_pooled$coef 
 hismodel9_pooled$exp_est <- exp(hismodel9_pooled$coef)
 hismodel9_pooled$exp_ll <-  exp(hismodel9_pooled$ll)
 hismodel9_pooled$exp_ul <-  exp(hismodel9_pooled$ul)
 
 




##Other Race 


##CRP Models
# CRP and Parental Sep

crp_model7_other <- with(dsub_other, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER, family=stats::gaussian()))
crp_model8_other <- with(dsub_other, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed, family=stats::gaussian()))
crp_model9_other <- with(dsub_other, svyglm(ln_crp~ psep_b + R13AGEY_B + RAGENDER + parent_ed  +edu + smoke + R13SHLTC +  R13HLTC + R13CONDE + R13ADLC + R13BMI, family=stats::gaussian()))


## Model 1
othermodel10_list <- list()
for(i in 1:length(crp_model7_other)){
  tmp_obj <- crp_model7_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel10_list[[i]] <- tmp
  
}


othermod10_reslong <- bind_rows(othermodel10_list, .id="setno")
varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender")
othermod10_reslong$var <- rep(varnames,5)


death_pool101 <- filter(othermod10_reslong, var=="Intercept")
death_pool102 <- filter(othermod10_reslong, var=="Experienced Parental Separation")
death_pool103 <- filter(othermod10_reslong, var=="Age")
death_pool104 <- filter(othermod10_reslong, var=="Gender")


dpooled101 <- pool.scalar(death_pool101$coef, death_pool101$vari)
dpooled102 <- pool.scalar(death_pool102$coef, death_pool102$vari)
dpooled103 <- pool.scalar(death_pool103$coef, death_pool103$vari)
dpooled104 <- pool.scalar(death_pool104$coef, death_pool104$vari)

pooled_est10 <- data.frame(var = varnames, coef=numeric(4), vari=numeric(4))


pooled_est10[1,2] <- dpooled101$qbar
pooled_est10[1,3] <- dpooled101$t

pooled_est10[2,2] <- dpooled102$qbar
pooled_est10[2,3] <- dpooled102$t

pooled_est10[3,2] <- dpooled103$qbar
pooled_est10[3,3] <- dpooled103$t

pooled_est10[4,2] <- dpooled104$qbar
pooled_est10[4,3] <- dpooled104$t



othermodel10_pooled <- pooled_est10 %>% 
    add_column(Model = "CRP, Model 1")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Other Race")

othermodel10_pooled$se <- sqrt(othermodel10_pooled$vari)
othermodel10_pooled$ll <- othermodel10_pooled$coef - (1.96*othermodel10_pooled$se) 
othermodel10_pooled$ul <- (1.96*othermodel10_pooled$se) + othermodel10_pooled$coef 
othermodel10_pooled$exp_est <- exp(othermodel10_pooled$coef)
othermodel10_pooled$exp_ll <-  exp(othermodel10_pooled$ll)
othermodel10_pooled$exp_ul <-  exp(othermodel10_pooled$ul)

othermodel10_pooled


## Model 2
othermodel11_list <- list()
for(i in 1:length(crp_model8_other)){
  tmp_obj <- crp_model8_other[[i]]
  coeff <- data.frame("coef"=tmp_obj$coefficients)
  vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
  tmp <-data.frame(bind_cols(coeff, vari))
  tmp$setno <- i
  othermodel11_list[[i]] <- tmp
  
}


othermod11_reslong <- bind_rows(othermodel11_list, .id="setno")

varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education")
othermod11_reslong$var <- rep(varnames,5)


death_pool111 <- filter(othermod11_reslong, var=="Intercept")
death_pool112 <- filter(othermod11_reslong, var=="Experienced Parental Separation")
death_pool113 <- filter(othermod11_reslong, var=="Age")
death_pool114 <- filter(othermod11_reslong, var=="Gender")
death_pool115 <- filter(othermod11_reslong, var=="Parental Education")


dpooled111 <- pool.scalar(death_pool111$coef, death_pool111$vari)
dpooled112 <- pool.scalar(death_pool112$coef, death_pool112$vari)
dpooled113 <- pool.scalar(death_pool113$coef, death_pool113$vari)
dpooled114 <- pool.scalar(death_pool114$coef, death_pool114$vari)
dpooled115 <- pool.scalar(death_pool115$coef, death_pool115$vari)


pooled_est11 <- data.frame(var = varnames, coef=numeric(5), vari=numeric(5))


pooled_est11[1,2] <- dpooled111$qbar
pooled_est11[1,3] <- dpooled111$t

pooled_est11[2,2] <- dpooled112$qbar
pooled_est11[2,3] <- dpooled112$t

pooled_est11[3,2] <- dpooled113$qbar
pooled_est11[3,3] <- dpooled113$t

pooled_est11[4,2] <- dpooled114$qbar
pooled_est11[4,3] <- dpooled114$t

pooled_est11[5,2] <- dpooled115$qbar
pooled_est11[5,3] <- dpooled115$t


othermodel11_pooled <- pooled_est11 %>% 
    add_column(Model = "CRP, Model 2")%>%
    add_column(Outcome = "CRP")%>%
    add_column(Race = "Other Race")

othermodel11_pooled$se <- sqrt(othermodel11_pooled$vari)
othermodel11_pooled$ll <- othermodel11_pooled$coef - (1.96*othermodel11_pooled$se) 
othermodel11_pooled$ul <- (1.96*othermodel11_pooled$se) + othermodel11_pooled$coef 
othermodel11_pooled$exp_est <- exp(othermodel11_pooled$coef)
othermodel11_pooled$exp_ll <-  exp(othermodel11_pooled$ll)
othermodel11_pooled$exp_ul <-  exp(othermodel11_pooled$ul)


 
# ##Model 3

 othermodel12_list <- list()
 for(i in 1:length(crp_model9_other)){
   tmp_obj <- crp_model9_other[[i]]
   coeff <- data.frame("coef"=tmp_obj$coefficients)
   vari <- data.frame("vari"=diag(vcov(tmp_obj))^2)
   tmp <-data.frame(bind_cols(coeff, vari))
   tmp$setno <- i
   othermodel12_list[[i]] <- tmp
   
 }

 othermodel12_reslong <- bind_rows( othermodel12_list, .id="setno")
 varnames <- c("Intercept", "Experienced Parental Separation", "Age", "Gender", "Parental Education" , "Education", "Smoking Status", "Change in Self-Reported Health", "Self-Report of Health Change" , "Chronic Condition Index" , "Change in Functional Limitations" , "BMI")
 othermodel12_reslong$var <- rep(varnames,100)
 
death_pool121 <- filter( othermodel12_reslong, var=="Intercept")
death_pool122 <- filter( othermodel12_reslong, var=="Experienced Parental Separation")
death_pool123 <- filter( othermodel12_reslong, var=="Age")
death_pool124 <- filter( othermodel12_reslong, var=="Gender")
death_pool125 <- filter( othermodel12_reslong, var=="Parental Education")
death_pool126 <- filter( othermodel12_reslong, var=="Education")
death_pool127 <- filter( othermodel12_reslong, var=="Smoking Status")
death_pool128 <- filter( othermodel12_reslong, var=="Change in Self-Reported Health")
death_pool129 <- filter( othermodel12_reslong, var=="Self-Report of Health Change")
death_pool1200 <- filter( othermodel12_reslong, var=="Chronic Condition Index")
death_pool1201 <- filter( othermodel12_reslong, var=="Change in Functional Limitations")
death_pool1202 <- filter( othermodel12_reslong, var=="BMI")

dpooled121 <- pool.scalar(death_pool121$coef, death_pool121$vari)
dpooled122 <- pool.scalar(death_pool122$coef, death_pool122$vari)
dpooled123 <- pool.scalar(death_pool123$coef, death_pool123$vari)
dpooled124 <- pool.scalar(death_pool124$coef, death_pool124$vari)
dpooled125 <- pool.scalar(death_pool125$coef, death_pool125$vari)
dpooled126 <- pool.scalar(death_pool126$coef, death_pool126$vari)
dpooled127 <- pool.scalar(death_pool127$coef, death_pool127$vari)
dpooled128 <- pool.scalar(death_pool128$coef, death_pool128$vari)
dpooled129 <- pool.scalar(death_pool129$coef, death_pool129$vari)
dpooled1200 <- pool.scalar(death_pool1200$coef, death_pool1200$vari)
dpooled1201 <- pool.scalar(death_pool1201$coef, death_pool1201$vari)
dpooled1202 <- pool.scalar(death_pool1202$coef, death_pool1202$vari)

pooled_est12 <- data.frame(var = varnames, coef=numeric(12), vari=numeric(12))
pooled_est12[1,2]=dpooled121$qbar
pooled_est12[1,3]=dpooled121$t
pooled_est12[2,2] <- dpooled122$qbar
pooled_est12[2,3] <- dpooled122$t
pooled_est12[3,2] <- dpooled123$qbar
pooled_est12[3,3] <- dpooled123$t
pooled_est12[4,2] <- dpooled124$qbar
pooled_est12[4,3] <- dpooled124$t
pooled_est12[5,2] <- dpooled125$qbar
pooled_est12[5,3] <- dpooled125$t
pooled_est12[6,2] <- dpooled126$qbar
pooled_est12[6,3] <- dpooled126$t
pooled_est12[7,2] <- dpooled127$qbar
pooled_est12[7,3] <- dpooled127$t
pooled_est12[8,2] <- dpooled128$qbar
pooled_est12[8,3] <- dpooled128$t
pooled_est12[9,2] <- dpooled129$qbar
pooled_est12[9,3] <- dpooled129$t
pooled_est12[10,2] <- dpooled1200$qbar
pooled_est12[10,3] <- dpooled1200$t
pooled_est12[11,2] <- dpooled1201$qbar
pooled_est12[11,3] <- dpooled1201$t
pooled_est12[12,2] <- dpooled1202$qbar
pooled_est12[12,3] <- dpooled1202$t

 othermodel12_pooled <- pooled_est12 %>% 
   add_column(Model = "CRP, Model 3")%>%
   add_column(Outcome = "CRP")%>%
   add_column(Race = "Other Race")

 othermodel12_pooled$se <- sqrt(othermodel12_pooled$vari)
 othermodel12_pooled$ll <- othermodel12_pooled$coef - (1.96*othermodel12_pooled$se) 
 othermodel12_pooled$ul <- (1.96*othermodel12_pooled$se) + othermodel12_pooled$coef 
 othermodel12_pooled$exp_est <- exp(othermodel12_pooled$coef)
 othermodel12_pooled$exp_ll <-  exp(othermodel12_pooled$ll)
 othermodel12_pooled$exp_ul <-  exp(othermodel12_pooled$ul)
 


model1_tot <- filter(blmodel1_pooled, var=="Experienced Parental Separation")
model2_tot <- filter(blmodel2_pooled, var=="Experienced Parental Separation")
model3_tot <- filter(blmodel3_pooled, var=="Experienced Parental Separation")
model4_tot <- filter(whmodel4_pooled, var=="Experienced Parental Separation")
model5_tot <- filter(whmodel5_pooled, var=="Experienced Parental Separation")
model6_tot <- filter(whmodel6_pooled, var=="Experienced Parental Separation")
model7_tot <- filter(hismodel7_pooled, var=="Experienced Parental Separation")
model8_tot <- filter(hismodel8_pooled, var=="Experienced Parental Separation")
model9_tot <- filter(hismodel9_pooled, var=="Experienced Parental Separation")
model10_tot <- filter(othermodel10_pooled, var=="Experienced Parental Separation")
model11_tot <- filter(othermodel11_pooled, var=="Experienced Parental Separation")
model12_tot <- filter(othermodel12_pooled, var=="Experienced Parental Separation")


  
model_total_crp_sep <-rbind(model1_tot, model2_tot, model3_tot, model4_tot, model5_tot,
                              model6_tot, model7_tot, model8_tot, model9_tot,
                              model10_tot, model11_tot, model12_tot)

model_total_crp_sep


model_crp_regress_sep <-rbind(blmodel1_pooled, blmodel2_pooled, blmodel3_pooled, whmodel4_pooled, whmodel5_pooled, whmodel6_pooled, hismodel7_pooled, hismodel8_pooled, hismodel9_pooled,  othermodel10_pooled, othermodel11_pooled, othermodel12_pooled)

write.csv(model_crp_regress_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CRPModel_Strat_sep.csv", row.names = FALSE)



plot1_crp_sep<-
  
  ggplot(data=model_total_crp_sep, aes(y=Model, x=exp_est, xmin=exp_ll, xmax=exp_ul))+
  geom_point()+
  geom_point(data=subset(model_total_crp_sep), color="Black", size=2)+
  geom_errorbarh(height=.1)+
  geom_vline(xintercept=1, color="black", linetype="dashed", alpha=.5)+
  scale_x_continuous(limits=c(0.75, 1.25))+
  ylab(label="")+
  xlab(label="Effect Estimate")+
  scale_y_discrete(limits=rev(unique(sort(model_total_crp_sep$Model))))+
  facet_grid(factor(Race,levels=c('Non-Hispanic Black', 'Hispanic', 'Other Race', 'Non-Hispanic White'))~.,  scales="free", space="free")+
  theme(strip.text.y=element_text(angle=0))


plot1_crp_sep
```


```{r}
#Exporting as a table 
write.csv(model_total_cmv_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CMVModel_death.csv", row.names = FALSE)

write.csv(model_total_cmv_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\CMVModel_sep.csv", row.names = FALSE)

write.csv(model_total_tnf_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\tnfModel_death.csv", row.names = FALSE)

write.csv(model_total_tnf_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\tnfModel_sep.csv", row.names = FALSE)

write.csv(model_total_il6_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\il6Model_death.csv", row.names = FALSE)

write.csv(model_total_il6_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\il6Model_sep.csv", row.names = FALSE)

write.csv(model_total_crp_death,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\crpModel_death.csv", row.names = FALSE)

write.csv(model_total_crp_sep,"C:\\LOCATION OF FOLDERS\\Tables\\Tables from R\\crpModel_sep.csv", row.names = FALSE)
```
